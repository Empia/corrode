{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;;;;;;;;;AAAA,IAAM,cAAc,QAAQ,gBAAR,CAApB;AACA,IAAM,QAAQ,QAAQ,SAAR,CAAd;;AAEA,IAAM,SAAS,QAAQ,QAAR,CAAf;AACA,IAAM,SAAS,QAAQ,eAAR,CAAf;;AAEA,IAAM,aAAa,EAAnB;AACA,IAAM,UAAU,QAAQ,OAAR,CAAhB;AACA,IAAM,aAAa,QAAQ,UAAR,CAAnB;;IAEM,O;;;AACF,uBAAa;AAAA;;AAAA,gGACA,SADA;;AAGT,cAAK,GAAL,GAAW,MAAM,UAAN,CAAiB,UAAjB,QAAX;AACA,cAAK,GAAL,GAAW,MAAM,aAAN,CAAoB,OAApB,QAAX;AACA,cAAK,MAAL,GAAc,MAAM,aAAN,CAAoB,UAApB,QAAd;AALS;AAMZ;;;;gCAEO,I,EAAM,M,EAAQ,E,EAAG;AACrB,gBAAG,WAAW,CAAd,EAAgB;AACZ,qBAAK,IAAL,CAAU,IAAV,IAAkB,EAAlB;AACA,uBAAO,IAAP;AACH;;AAED,gBAAI,kBAAkB,CAAtB;;AAEA,gBAAI,YAAY,SAAZ,SAAY,CAAS,GAAT,EAAc,OAAd,EAAsB;AAClC,mBAAG,IAAH,CAAQ,IAAR,EAAc,eAAd,EAA+B,GAA/B,EAAoC,OAApC;;AAEA,oBAAG,EAAE,eAAF,GAAoB,SAAS,CAAhC,EAAkC;AAC9B,sCAAkB,CAAlB;AACA;AACH;AACJ,aAPD;;AASA,gBAAG,OAAO,IAAP,KAAgB,QAAnB,EAA4B;AACxB,qBAAK,MAAL;AACA,yBAAS,IAAT;AACA,uBAAO,SAAP;AACH;;AAED,gBAAG,CAAC,IAAJ,EAAS;AACL,uBAAO,KAAK,IAAL,CAAU,SAAV,CAAP;AACH;;AAED,mBAAO,KAAK,IAAL,CAAU,IAAV,EAAgB,SAAhB,CAAP;AACH;;;8BAEK,I,EAAqC;AAAA,gBAA/B,UAA+B,yDAAlB,CAAkB;AAAA,gBAAf,IAAe,yDAAR,OAAQ;;AACvC,yBAAa,OAAO,UAAP,KAAsB,QAAtB,GAAiC,WAAW,UAAX,CAAsB,CAAtB,CAAjC,GAA4D,UAAzE;;AAEA,mBAAO,KACF,IADE,CACG,IADH,EACS,UAAS,GAAT,EAAa;AACrB,qBACK,IADL,EACW,SADX,EAEK,GAFL,CAES,YAAU;AACX,wBAAG,KAAK,IAAL,CAAU,OAAV,KAAsB,UAAzB,EAAoC;AAChC,4BAAI,IAAJ;AACH;AACJ,iBANL;AAOH,aATE,EAUF,GAVE,CAUE,YAAU;AACX,qBAAK,IAAL,CAAU,IAAV,IAAkB,KAAK,IAAL,CAAU,IAAV,EAAgB,GAAhB,CAAoB;AAAA,2BAAO,IAAI,OAAX;AAAA,iBAApB,CAAlB;AACH,aAZE,CAAP;AAaH;;;yCAEgB,I,EAAyC;AAAA,gBAAnC,UAAmC,yDAAtB,CAAsB;AAAA,gBAAnB,QAAmB,yDAAR,OAAQ;;AACtD,yBAAa,OAAO,UAAP,KAAsB,QAAtB,GAAiC,WAAW,UAAX,CAAsB,CAAtB,CAAjC,GAA4D,UAAzE;;AAEA,mBAAO,KACF,KADE,CACI,IADJ,EACU,UADV,EAEF,GAFE,CAEE,YAAU;AACX,oBAAG,CAAC,KAAK,IAAL,CAAU,IAAV,CAAD,IAAoB,KAAK,IAAL,CAAU,IAAV,EAAgB,MAAhB,KAA2B,CAAlD,EAAoD;AAChD,yBAAK,IAAL,CAAU,IAAV,IAAkB,EAAlB;AACH,iBAFD,MAEO;AACH,yBAAK,IAAL,CAAU,IAAV,IAAkB,IAAI,MAAJ,CAAW,KAAK,IAAL,CAAU,IAAV,CAAX,EAA4B,QAA5B,CAAqC,QAArC,CAAlB;AACH;AACJ,aARE,CAAP;AASH;;;gCAEO,I,EAAM,K,EAAsB;AAAA,gBAAf,IAAe,yDAAR,OAAQ;;AAChC,mBAAO,KACF,IADE,EACI,IADJ,EAEF,GAFE,CAEE,GAFF,CAEM,IAFN,EAGF,MAHE,CAGK,aAHL,CAGmB,IAHnB,EAGyB,KAHzB,EAIF,GAJE,CAIE,SAJF,CAIY,IAJZ,EAIkB,KAJlB,CAAP;AAKH;;;iCAEQ,M,EAAO;AACZ,mBAAO,KACF,GADE,CACE,YAAU;AACX,oBAAG,OAAO,MAAP,KAAkB,QAArB,EAA8B;AAC1B,yBAAK,MAAL,CAAY,MAAZ,CAAmB,MAAnB;AACA,6BAAS,KAAK,IAAL,CAAU,MAAV,CAAT;AACH;;AAED,qBAAK,IAAL,CAAU,SAAS,KAAK,YAAxB;AACH,aARE,CAAP;AASH;;;mCAEwB;AAAA,gBAAhB,IAAgB,yDAAT,QAAS;;AACrB,mBAAO,KACF,MADE,CACK,MADL,CACY,IADZ,EAEF,GAFE,CAEE,YAAU;AACX,qBAAK,IAAL,GAAY,KAAK,IAAL,CAAU,IAAV,CAAZ;AACH,aAJE,CAAP;AAKH;;;gCAEM;AACH,mBAAO,KAAK,GAAL,CAAS,YAAU;AACtB,wBAAQ,GAAR,CAAY,KAAK,IAAjB;AACH,aAFM,CAAP;AAGH;;;mCAEU,M,EAAO;AACd,iBAAK,KAAL,CAAW,MAAX;AACA,mBAAO,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,GAA4B,KAAK,SAAL,CAAe,CAAf,CAA5B,GAAgD,KAAK,IAA5D;AACH;;;;EA5GiB,W;;AA+GtB,OAAO,OAAP,GAAiB,YAAU;AACvB,8CAAW,OAAX,2CAAsB,SAAtB;AACH,CAFD;;AAIA,OAAO,OAAP,CAAe,YAAf,GAA8B,UAAS,IAAT,EAAe,EAAf,EAAmB,SAAnB,EAA6B;AACvD,WAAO,EAAP,EAAW,IAAX;;AAEA,eAAW,IAAX,IAAmB,YAAkC;AAAA,0CAAL,IAAK;AAAL,gBAAK;AAAA;;AAAA,YAAzB,IAAyB,yDAAlB,QAAkB;;AACjD,aAAK,GAAL,CAAS,IAAT,EAAe,YAAU;AACrB,eAAG,KAAH,CAAS,IAAT,EAAe,IAAf;AACH,SAFD;;AAIA,YAAG,OAAO,SAAP,KAAqB,WAAxB,EAAoC;AAChC,iBAAK,GAAL,CAAS,YAAU;AACf,uBAAO,MAAP,CAAc,KAAK,IAAL,CAAU,IAAV,CAAd,EAA+B,SAA/B;AACH,aAFD;AAGH;;AAED,eAAO,IAAP;AACH,KAZD;;AAcA,eAAW,IAAX,EAAiB,KAAjB,GAAyB,EAAzB;AACH,CAlBD;;AAoBA,OAAO,OAAP,CAAe,UAAf,GAA4B,UAA5B;AACA,OAAO,OAAP,CAAe,OAAf,GAAyB,OAAzB;AACA,OAAO,OAAP,CAAe,UAAf,GAA4B,UAA5B","file":"index.js","sourcesContent":["const CorrodeBase = require('./corrode-base');\nconst utils = require('./utils');\n\nconst lodash = require('lodash');\nconst fnName = require('function-name');\n\nconst EXTENSIONS = {};\nconst MAPPERS = require('./map');\nconst ASSERTIONS = require('./assert');\n\nclass Corrode extends CorrodeBase {\n    constructor(){\n        super(...arguments);\n\n        this.ext = utils.bindObject(EXTENSIONS, this);\n        this.map = utils.tapBindObject(MAPPERS, this);\n        this.assert = utils.tapBindObject(ASSERTIONS, this);\n    }\n\n    loopMax(name, length, fn){\n        if(length === 0){\n            this.vars[name] = [];\n            return this;\n        }\n\n        let currentPosition = 0;\n\n        let loopGuard = function(end, discard){\n            fn.call(this, currentPosition, end, discard);\n\n            if(++currentPosition > length - 1){\n                currentPosition = 0;\n                end();\n            }\n        };\n\n        if(typeof name === 'number'){\n            fn = length;\n            length = name;\n            name = undefined;\n        }\n\n        if(!name){\n            return this.loop(loopGuard);\n        }\n\n        return this.loop(name, loopGuard);\n    }\n\n    array(name, terminator = 0, type = 'uint8'){\n        terminator = typeof terminator === 'string' ? terminator.charCodeAt(0) : terminator;\n\n        return this\n            .loop(name, function(end){\n                this\n                    [type]('__value')\n                    .tap(function(){\n                        if(this.vars.__value === terminator){\n                            end(true);\n                        }\n                    });\n            })\n            .tap(function(){\n                this.vars[name] = this.vars[name].map(val => val.__value);\n            });\n    }\n\n    terminatedString(name, terminator = 0, encoding = 'ascii'){\n        terminator = typeof terminator === 'string' ? terminator.charCodeAt(0) : terminator;\n\n        return this\n            .array(name, terminator)\n            .tap(function(){\n                if(!this.vars[name] || this.vars[name].length === 0){\n                    this.vars[name] = '';\n                } else {\n                    this.vars[name] = new Buffer(this.vars[name]).toString(encoding);\n                }\n            });\n    }\n\n    pointer(name, array, type = 'int64'){\n        return this\n            [type](name)\n            .map.abs(name)\n            .assert.inArrayBounds(name, array)\n            .map.fromArray(name, array);\n    }\n\n    position(offset){\n        return this\n            .tap(function(){\n                if(typeof offset === 'string'){\n                    this.assert.exists(offset);\n                    offset = this.vars[offset];\n                }\n\n                this.skip(offset - this.streamOffset);\n            });\n    }\n\n    pushVars(name = 'values'){\n        return this\n            .assert.exists(name)\n            .tap(function(){\n                this.vars = this.vars[name];\n            });\n    }\n\n    debug(){\n        return this.tap(function(){\n            console.log(this.vars);\n        });\n    }\n\n    fromBuffer(buffer){\n        this.write(buffer);\n        return this.vars_list.length > 0 ? this.vars_list[0] : this.vars;\n    }\n}\n\nmodule.exports = function(){\n    return new Corrode(...arguments);\n};\n\nmodule.exports.addExtension = function(name, fn, extension){\n    fnName(fn, name);\n\n    EXTENSIONS[name] = function(name = 'values', ...args){\n        this.tap(name, function(){\n            fn.apply(this, args);\n        });\n\n        if(typeof extension !== 'undefined'){\n            this.tap(function(){\n                lodash.extend(this.vars[name], extension);\n            });\n        }\n\n        return this;\n    };\n\n    EXTENSIONS[name].orgFn = fn;\n};\n\nmodule.exports.EXTENSIONS = EXTENSIONS;\nmodule.exports.MAPPERS = MAPPERS;\nmodule.exports.ASSERTIONS = ASSERTIONS;\n"]}